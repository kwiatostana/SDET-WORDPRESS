# **Тестовый набор: WordPress API (CRUD and DB Validation)**

**Тестируемый проект:** Локальный WordPress  
**Инструменты:** Python (Requests, Pytest, Xdist, Ruff), MySQL Connector

## **1\. Позитивные сценарии (Positive)**

### **TC\_POS\_001: Создание нового поста**

**Цель:** Проверить, что пост создается через API и корректно сохраняется в таблице wp\_posts.

**Предусловие:**

1. Настроить HTTP-клиент с авторизацией Basic Auth (права администратора) или убедиться в его существовании.  
2. Сгенерировать уникальные данные:  
   *title \= "Auto Test Title \[UUID\]"*

**Шаги:**

1. **Отправить** POST запрос на /wp/v2/posts с заголовком Content-Type: application/json и сгенерированным телом запроса со следующими тестовыми данными:

*{*

*title: "Auto Test Title \[UUID\]",*

*content: "Test content body",*

*status: "publish"*

*}*

2. **Сохранить** id созданного поста из ответа API.  
3. **Выполнить** SQL-запрос к БД:  
   SELECT post\_title, post\_content, post\_status FROM wp\_posts WHERE ID \= {id}

**Ожидаемые результаты:**

* **Шаг 1 (API):**  
  * Код ответа: 201 Created.  
  * В теле ответа поле id не пустое (integer).  
  * Поле title.raw совпадает с отправленным title.  
  * Поле status равно "publish".  
  *   
* **Шаг 3 (БД):**  
  * SQL-запрос возвращает 1 строку.  
  * Значение post\_title в БД совпадает с отправленным title.  
  * Значение post\_content в БД совпадает с отправленным content.  
  * Значение post\_status в БД равно "publish".

**Пример тела ответа:**

*{*

    *"id": 45,*

    *"date": "2025-11-19T10:00:00",*

    *"status": "publish",*

    *"title": {*

        *"raw": "Auto Test Title 550e8400-e29b…"*

*…*

    *},*

    *"content": {*

        *"raw": "Test content body",*

        *...*

    *}*

}

**Постусловие:**  
**Удалить** созданный пост запросом DELETE /wp/v2/posts/{id}\&force=true.

### **TC\_POS\_002: Получение поста по ID**

**Цель:** Проверить, что API возвращает данные, соответствующие записи в базе данных.

**Предусловие:**

Повторить предусловие и шаги 1 и 2 по тест-кейсу **TC\_POS\_001**.

**Шаги:**

1. **Отправить** GET запрос на /wp/v2/posts/{id}.  
2. **Выполнить** SQL-запрос к БД:  
   SELECT post\_title, post\_status FROM wp\_posts WHERE ID \= {id}

**Ожидаемые результаты:**

* **Шаг 1 (API):**  
  * Код ответа: 200 OK.  
  * Поле id в ответе совпадает с запрашиваемым.  
* **Шаг 2 (БД):**  
  * Значение title.raw из API совпадает с post\_title из БД.  
  * Значение status из API совпадает с post\_status из БД.

**Пример тела ответа:**

*{*

    *"id": 49,*

    *"status": "publish",*

    *"title": {*

        *"raw": "Auto Test Title 650e8400-e29b..."*

*…*

    *}*

*}*

**Постусловие:**  
**Удалить** созданный пост запросом DELETE /wp/v2/posts/{id}\&force=true.

### **TC\_POS\_003: Получение списка постов**

**Цель:** Проверить, что несколько созданных постов присутствуют в общем списке, возвращаемом API.

**Предусловие:**

Повторить предусловие и основной шаг 1 по тест-кейсу **TC\_POS\_001** дважды, чтобы создать два поста. Сохранить их идентификаторы `id_1` и `id_2`.

**Шаги:**

1. **Отправить** GET запрос на `/wp/v2/posts?include={id_1},{id_2}`.  
2. **Выполнить** SQL-запрос: `SELECT count(*) FROM wp_posts WHERE ID IN ({id_1}, {id_2})`.

**Ожидаемые результаты:**

* **Шаг 1 (API):**  
  * Код ответа: 200 OK.  
  * Ответ представляет собой список.  
  * В массиве присутствуют объекты с `id_1` и `id_2`.  
* **Шаг 2 (БД):**  
  * SQL-запрос возвращает значение 2.

**Пример тела ответа:**

*\[*

    *{*

        *"id": 46,*

        *"title": {* 

*"raw": "Auto Test Title 750e8400-e29b.."* 

*…*

*}*,
    *{*

        *"id": 47,*

        *"title": {* 

*"raw": "Auto Test Title 850e8400-e29b.."* 

*…*
}

*…*

*\]*

**Постусловие:**  
**Удалить** созданные посты запросами `DELETE /wp/v2/posts/{id_1}\&force=true` и `DELETE /wp/v2/posts/{id_2}\&force=true`.

### **TC\_POS\_004: Редактирование поста**

**Цель:** Проверить обновление данных поста через API и их изменение в БД.

**Предусловие:** 

1. Повторить предусловие и основные шаги 1 и 2 по тест-кейсу **TC\_POS\_001.**  
2. Сохранить сгенерированный title с \[UUID\].

**Шаги:**

1. **Отправить** POST запрос на /wp/v2/posts/{id} с телом:  
   {"title": "сгенерированный title с \[UUID\] and Updated", "content": "Updated Content"}  
2. **Выполнить** SQL-запрос к БД:  
   SELECT post\_title, post\_content FROM wp\_posts WHERE ID \= {id}

**Ожидаемые результаты:**

* **Шаг 1 (API):**  
  * Код ответа: 200 OK.  
  * В теле ответа title.raw равен "сгенерированный title с \[UUID\] and Updated".  
  * В теле ответа content.raw равен "Updated Content".  
*   
* **Шаг 2 (БД):**  
  * post\_title равен "сгенерированный title с \[UUID\] and Updated".  
  * post\_content равен "Updated Content".

**Пример тела ответа:**

*{*

    *"id": 11,*

    *"title": {*

        *"raw": "Auto Test Title* 250e8400-e29b... and Updated*"*

*…*

    *},*

    *"content": {*

        *"raw": "Updated Content",*

        *...*

    *}*

*}*

**Постусловие:**  
**Удалить** пост запросом DELETE /wp/v2/posts/{id}\&force=true.

### **TC\_POS\_005: Удаление поста**

**Цель:** Проверить физическое удаление поста из базы данных при использовании флага force.

**Предусловие:**

Повторить предусловие и основные шаги 1 и 2 по тест-кейсу **TC\_POS\_001**.

**Шаги:**

1. **Отправить** DELETE запрос на /wp/v2/posts/{id}\&force=true  
2. **Выполнить** SQL-запрос к БД:  
   SELECT ID FROM wp\_posts WHERE ID \= {id}

**Ожидаемые результаты:**

* **Шаг 1 (API):**  
  * Код ответа: 200 OK.  
  * В теле ответа поле "deleted": true.  
  * В теле ответа поле "previous" содержит данные удаленного поста.  
*   
* **Шаг 2 (БД):**  
  * SQL-запрос возвращает пустой результат (0 строк). Запись отсутствует в БД.

**Пример тела ответа:**

*{*

    *"deleted": true,*

    *"previous": {*

        *"id": 25,*

        *"title": {* 

*"raw": "Auto Test Title 950e8400-e29b..."* 

*…*

*}*

*}*

## **2\. Негативные сценарии (Negative)**

### **TC\_NEG\_001: Создание поста с недопустимым параметром**

**Цель:** Проверить валидацию входных данных (попытка выставить несуществующий статус).

**Предусловие:**

1. Настроить HTTP-клиент с авторизацией Basic Auth (права администратора).  
2. Сгенерировать уникальные данные:  
   title \= "Auto Test Title \[UUID\]"

**Шаги:**

1. **Отправить** POST запрос на /wp/v2/posts с телом:

*{*

*"title": "Auto Test Title \[UUID\]",*

*"status": "invalid\_status\_xyz”*

*}*

2. **Выполнить** SQL-запрос к БД для проверки, не создался ли пост:  
   SELECT ID FROM wp\_posts WHERE post\_title \= 'Auto Test Title \[UUID\]'

**Ожидаемые результаты:**

* **Шаг 1 (API):**  
  * Код ответа: 400 Bad Request.  
  * В теле ответа код ошибки: "rest\_invalid\_param".  
* **Шаг 2 (БД):**  
  * SQL-запрос возвращает пустой результат (запись не создана).

**Пример тела ответа:**

*{*

    *"code": "rest\_invalid\_param",*

    *"message": "Неверный параметр: status",*

    *"data": {*

        *"status": 400,*

        *"params": {*

            *"status": "status не принадлежит к publish, future, draft, pending и private."*

        *},*

*…*

*}*

### **TC\_NEG\_002: Запрос несуществующего поста**

**Цель:** Проверить обработку запроса к несуществующему ресурсу.

**Предусловие:**

Настроить HTTP-клиент с авторизацией Basic Auth (права администратора).

**Шаги:**

1. **Отправить GET** запрос на /wp/v2/posts/0 (заведомо несуществующий идентификатор).  
2. **Выполнить** SQL-запрос к БД:  
   SELECT ID FROM wp\_posts WHERE ID \= 0

**Ожидаемые результаты:**

* **Шаг 1 (API):**  
  * Код ответа: 404 Not Found.  
  * В теле ответа код ошибки: "rest\_post\_invalid\_id".  
* **Шаг 2 (БД):**  
  * SQL-запрос возвращает 0 строк (подтверждение отсутствия данных).

**Пример тела ответа:**

*{*

    *"code": "rest\_post\_invalid\_id",*

    *"message": "Неверный ID записи.",*

    *"data": {*

        *"status": 404*

    *}*

*}*